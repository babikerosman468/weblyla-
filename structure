
âœ… Final server6.js

require('dotenv').config();
const express = require('express');
const mysql = require('mysql2');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3010;

// --- DB connection ---
const db = mysql.createConnection({
  host: process.env.DB_HOST || 'localhost',
  port: process.env.DB_PORT || 3306,
  user: process.env.DB_USER || 'babsuser',
  password: process.env.DB_PASS || 'babsroot',
  database: process.env.DB_NAME || 'babsdb',
  socketPath: process.env.DB_SOCKET || undefined,
});

db.connect(err => {
  if (err) {
    console.error('âŒ DB connection failed:', err.message);
    process.exit(1);
  }
  console.log('âœ… Connected to MariaDB!');
});

// --- Serve static folders ---
app.use('/hub', express.static(path.join(__dirname, 'myglobalhearthub')));
app.use('/babsapp', express.static(path.join(__dirname, 'babsapp')));

// --- Redirect root to hub ---
app.get('/', (req, res) => {
  res.redirect('/hub');
});

// --- Example DB ping ---
app.get('/pingdb', (req, res) => {
  db.query('SELECT NOW() AS now', (err, results) => {
    if (err) {
      console.error('âŒ DB query failed:', err.message);
      return res.status(500).json({ error: err.message });
    }
    res.json({ server_time: results[0].now });
  });
});

// --- Start server ---
const server = app.listen(PORT, async () => {
  console.log(`ğŸš€ Server running at http://localhost:${PORT}`);
  console.log(`ğŸ“Œ Main site:   http://localhost:${PORT}/hub`);
  console.log(`ğŸ“Œ BabsApp:     http://localhost:${PORT}/babsapp`);
});

// --- Graceful shutdown ---
const shutdown = () => {
  console.log('\nâ³ Shutting down...');
  server.close(() => {
    console.log('âœ… HTTP server closed.');
    db.end(err => {
      if (err) console.error('âš ï¸ Error closing DB:', err.message);
      else console.log('âœ… DB connection closed.');
      process.exit(0);
    });
  });
};

process.on('SIGINT', shutdown);
process.on('SIGTERM', shutdown);


---

âœ… Folder structure

~/mariadb/
â”œâ”€â”€ server6.js
â”œâ”€â”€ .env
â”œâ”€â”€ myglobalhearthub/
â”‚   â”œâ”€â”€ index.html  (this is your copyall.html renamed)
â”‚   â””â”€â”€ [images, css, assets...]
â”œâ”€â”€ babsapp/
â”‚   â”œâ”€â”€ all.html
â”‚   â”œâ”€â”€ compiletex1.sh
â”‚   â”œâ”€â”€ editor.html
â”‚   â”œâ”€â”€ note.tex
â”‚   â”œâ”€â”€ note.pdf
â”‚   â””â”€â”€ [other assets...]


---

âœ… What you get

http://localhost:3010/ â†’ redirects to /hub

http://localhost:3010/hub â†’ opens copyall.html (as index.html)

http://localhost:3010/babsapp â†’ opens all.html and all LaTeX files

Database stays connected and ready for dynamic work later



---

âœ… Next step

1ï¸âƒ£ Rename copyall.html â†’ index.html in myglobalhearthub/
2ï¸âƒ£ Place all.html & compiletex1.sh in babsapp/
3ï¸âƒ£ Save this server6.js to ~/mariadb/

Then run:

node server6.js


---

ğŸ“¦ If you want, I can zip this exact folder tree for you right now. Say: âœ ZIP IT

âœ¨ Letâ€™s finish this cleanly!


